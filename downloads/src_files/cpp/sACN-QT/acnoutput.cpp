#include "acnoutput.h"
#include <stdio.h>

char* ACNOutput::output = NULL;

void ACNOutput::initACN()
{
    char ACNHeader[] = {
        // Root layer
        0x00, 0x10, // Preamble
        0x00, 0x00, // Postamble
        0x41, 0x53, 0x43, 0x2d, 0x45, 0x31, 0x2e, 0x31, 0x37, 0x00, 0x00, 0x00, // ACN packet Identifier
        0x72, 0x6e, // Flags + Length
        0x00, 0x00, 0x00, 0x04, //Vector
        0x3e, 0xed, 0x0c, 0x49, 0x30, 0x1e, 0x41, 0x24, 0xa7, 0xc6, 0xff, 0x76, 0x0e, 0xc1, 0x2f, 0xf0, // CID - Pre generated. (probably bad)

        // Framing layer
        0x72, 0x58, //Plags + length
        0x00, 0x00, 0x00, 0x02, //Vector
        'L', 'o', 'u', 'i', 's', ' ', 'T', 'e', 's', 't', 'i', 'n', 'g', 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x65,// priority
        0x00, 0x00, //Reserved
        0x00, //Sequence number
        0x00, //options
        0x00, 0x01, //universe

        //DMP layer
        0x72, 0x0b,
        0x02,
        0xa1,
        0x00, 0x00,
        0x00, 0x01,
        0x02, 0x01,
    };

    char DMXVals[513];
    DMXVals[0] = 0x00;

    for(int i = 1; i < sizeof(DMXVals); i++){
        DMXVals[i] = 0x00;
    }

    output = new char[638];
    for(int i = 0; i < sizeof(ACNHeader); i++){
        output[i] = ACNHeader[i];
    }

    for(int i = 0; i < sizeof(DMXVals); i++){
        output[i+125] = DMXVals[i];
    }
}

void ACNOutput::setValAt(short index, char val)
{
    output[index] = val;
}

QByteArray ACNOutput::getOutputByteArray(){
    output[111]++;
    return QByteArray::fromRawData(output,638);
}
